<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barbería Frames - Reserva tu turno</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #0ea5e9;
      --secondary: #22c55e;
      --dark: #0f172a;
      --darker: #020617;
      --light: #f8fafc;
      --gray: #64748b;
      --border: #334155;
      --shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
      --glow: 0 0 20px rgba(14, 165, 233, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
      color: var(--light);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-links a {
      color: var(--light);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: var(--primary);
    }

    /* Hero Section */
    .hero {
      padding: 4rem 0;
      text-align: center;
    }

    .hero h1 {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.25rem;
      color: var(--gray);
      max-width: 600px;
      margin: 0 auto 2rem;
    }

    /* Booking Section */
    .booking-section {
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 3rem;
      margin: 2rem 0;
      backdrop-filter: blur(10px);
    }

    .booking-title {
      text-align: center;
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .booking-subtitle {
      text-align: center;
      color: var(--gray);
      margin-bottom: 2rem;
    }

    .booking-buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #0284c7);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: var(--shadow);
      min-width: 200px;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--glow);
    }

    .btn-secondary {
      background: transparent;
      color: var(--gray);
      border: 1px solid var(--border);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-secondary:hover {
      color: var(--light);
      border-color: var(--primary);
    }

    /* Services */
    .services {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin: 3rem 0;
    }

    .service-card {
      background: rgba(15, 23, 42, 0.3);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      transition: all 0.3s;
    }

    .service-card:hover {
      transform: translateY(-4px);
      border-color: var(--primary);
      box-shadow: var(--shadow);
    }

    .service-card h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .service-card p {
      color: var(--gray);
      margin-bottom: 1rem;
    }

    .price {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--secondary);
    }

    /* Info Section */
    .info-section {
      background: rgba(15, 23, 42, 0.3);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
    }

    .info-section h3 {
      color: var(--secondary);
      margin-bottom: 1rem;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--gray);
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: var(--dark);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    }

    .modal h3 {
      color: var(--secondary);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .modal p {
      color: var(--gray);
      margin-bottom: 2rem;
    }

    /* Diagnostic Panel */
    .diagnostic {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--darker);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      max-width: 400px;
      font-size: 0.9rem;
      z-index: 999;
      display: none;
    }

    .diagnostic h4 {
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .diagnostic .log {
      color: var(--gray);
      font-family: monospace;
      font-size: 0.8rem;
      max-height: 150px;
      overflow-y: auto;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }
      
      .booking-section {
        padding: 2rem 1rem;
      }
      
      .services {
        grid-template-columns: 1fr;
      }
    }

    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <nav class="container">
      <div class="logo">
        <div class="logo-icon">BF</div>
        <span>Barbería Frames</span>
      </div>
      <ul class="nav-links">
        <li><a href="#servicios">Servicios</a></li>
        <li><a href="#reservar">Reservar</a></li>
        <li><a href="#contacto">Contacto</a></li>
      </ul>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Hero Section -->
    <section class="hero fade-in">
      <h1>Cortes profesionales, reservas sencillas</h1>
      <p>Agenda tu turno con disponibilidad en tiempo real a través de nuestro sistema integrado con Google Calendar.</p>
    </section>

    <!-- Booking Section -->
    <section id="reservar" class="booking-section fade-in">
      <h2 class="booking-title">Reserva tu turno</h2>
      <p class="booking-subtitle">Selecciona fecha y hora disponible. Recibirás confirmación y recordatorios automáticos.</p>
      
      <div class="booking-buttons">
        <button id="btn-reservar" class="btn-primary">
          📅 Reservar turno ahora
        </button>
        <p style="color: var(--gray); font-size: 0.9rem; max-width: 400px; text-align: center;">
          Se abrirá una ventana de Google Calendar para completar tu reserva. Al finalizar y cerrar la ventana, verás un mensaje de confirmación.
        </p>
      </div>
    </section>

    <!-- Services -->
    <section id="servicios" class="services fade-in">
      <div class="service-card">
        <h3>Corte Clásico</h3>
        <p>Estilo limpio y definido con terminaciones profesionales a tijera o máquina según tu preferencia.</p>
        <div class="price">$15.000</div>
      </div>
      <div class="service-card">
        <h3>Barba y Contornos</h3>
        <p>Afeitado prolijo con toalla caliente, definición de líneas y acabado perfecto para tu estilo.</p>
        <div class="price">$10.000</div>
      </div>
      <div class="service-card">
        <h3>Combo Completo</h3>
        <p>Servicio integral: corte + barba + asesoría de estilo personalizada para un look profesional.</p>
        <div class="price">$22.000</div>
      </div>
    </section>

    <!-- Info Section -->
    <section id="contacto" class="info-section fade-in">
      <h3>📍 Información y Horarios</h3>
      <div class="info-grid">
        <div class="info-item">
          <span>🕒</span>
          <span>Lun - Sáb: 10:00 - 20:00</span>
        </div>
        <div class="info-item">
          <span>📍</span>
          <span>Av. Principal 123, Ciudad</span>
        </div>
        <div class="info-item">
          <span>📱</span>
          <span>+57 300 123 4567</span>
        </div>
        <div class="info-item">
          <span>📧</span>
          <span>info@barberiaframes.com</span>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de Agradecimiento -->
  <div id="thanks-modal" class="modal">
    <div class="modal-content">
      <h3>🎉 ¡Gracias por tu reserva!</h3>
      <p>Tu turno ha sido registrado exitosamente en nuestro sistema. Recibirás la confirmación y recordatorios automáticos en tu email.</p>
      <p style="font-size: 0.9rem; color: var(--gray);">Te esperamos en Barbería Frames para brindarte el mejor servicio.</p>
      <button id="thanks-close" class="btn-primary">Perfecto, gracias</button>
    </div>
  </div>

  <!-- Panel de Diagnóstico -->
  <div id="diagnostic" class="diagnostic">
    <h4>🔧 Diagnóstico del Sistema</h4>
    <div id="diagnostic-log" class="log"></div>
    <button id="clear-log" class="btn-secondary" style="margin-top: 0.5rem; font-size: 0.8rem;">Limpiar log</button>
  </div>

  <script>
    // Sistema de reservas con Google Calendar
    (function() {
      // URL de tu Google Calendar Appointment Scheduling
      const BOOKING_URL = 'https://calendar.google.com/calendar/appointments/schedules/AcZssZ2qKy6BclnXPW03LJKRvdG1anz4jZyYqCc2qUv_JUM4b_IcPBGHNPxkvW6Y5TU5gu5J0AOoJrPw?gv=true';
      
      let popupWindow = null;
      let pollTimer = null;
      let openedAt = 0;
      let hasShownThanks = false;

      // Sistema de logging para diagnóstico
      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logElement = document.getElementById('diagnostic-log');
        const diagnostic = document.getElementById('diagnostic');
        
        console.log(`[BARBERÍA] ${message}`);
        
        if (logElement) {
          const logLine = `[${timestamp}] ${message}\n`;
          logElement.textContent += logLine;
          logElement.scrollTop = logElement.scrollHeight;
          diagnostic.style.display = 'block';
        }
      }

      // Función principal para abrir el popup de reservas
      function openBookingPopup() {
        log('Iniciando proceso de reserva...');

        // Calcular dimensiones del popup
        const width = Math.min(1000, Math.floor(window.innerWidth * 0.9));
        const height = Math.min(800, Math.floor(window.innerHeight * 0.9));
        const left = Math.max(0, Math.floor((screen.width - width) / 2));
        const top = Math.max(0, Math.floor((screen.height - height) / 2));

        // Si ya hay un popup abierto, enfocarlo
        if (popupWindow && !popupWindow.closed) {
          log('Popup ya existe, enfocando ventana existente');
          try {
            popupWindow.focus();
          } catch (e) {
            log('Error al enfocar popup existente: ' + e.message);
          }
          return;
        }

        // Resetear estado
        hasShownThanks = false;

        // Abrir nueva ventana popup
        try {
          popupWindow = window.open(
            BOOKING_URL,
            'barber_booking',
            `popup=yes,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=${width},height=${height},left=${left},top=${top}`
          );

          // Verificar si el popup fue bloqueado
          if (!popupWindow || popupWindow.closed || typeof popupWindow.closed === 'undefined') {
            log('Popup bloqueado por el navegador, abriendo en nueva pestaña');
            window.open(BOOKING_URL, '_blank');
            return;
          }

          // Registrar tiempo de apertura
          openedAt = Date.now();
          log('Popup abierto correctamente');

          // Enfocar el popup
          setTimeout(() => {
            try {
              popupWindow.focus();
            } catch (e) {
              log('Error al enfocar popup: ' + e.message);
            }
          }, 100);

          // Iniciar monitoreo del popup
          startPopupMonitoring();

        } catch (error) {
          log('Error al abrir popup: ' + error.message);
          // Fallback: abrir en nueva pestaña
          window.open(BOOKING_URL, '_blank');
        }
      }

      // Monitoreo del estado del popup
      function startPopupMonitoring() {
        clearInterval(pollTimer);
        
        pollTimer = setInterval(() => {
          try {
            // Verificar si el popup sigue abierto
            if (!popupWindow || popupWindow.closed) {
              clearInterval(pollTimer);
              handlePopupClosed();
            }
          } catch (error) {
            // Error al acceder al popup (puede indicar que se cerró)
            clearInterval(pollTimer);
            handlePopupClosed();
          }
        }, 1000); // Verificar cada segundo

        log('Iniciado monitoreo del popup');
      }

      // Manejar el cierre del popup
      function handlePopupClosed() {
        const sessionDuration = Date.now() - openedAt;
        const durationSeconds = Math.round(sessionDuration / 1000);
        
        log(`Popup cerrado después de ${durationSeconds} segundos`);

        // Solo mostrar agradecimiento si:
        // 1. El popup estuvo abierto al menos 15 segundos (tiempo mínimo para hacer una reserva)
        // 2. No hemos mostrado ya el mensaje de agradecimiento
        if (sessionDuration >= 15000 && !hasShownThanks) {
          log('Mostrando mensaje de agradecimiento');
          setTimeout(showThanksModal, 800); // Pequeño delay para suavidad
        } else if (sessionDuration < 15000) {
          log('Sesión muy corta, probablemente no completó reserva');
        }
      }

      // Mostrar modal de agradecimiento
      function showThanksModal() {
        hasShownThanks = true;
        const modal = document.getElementById('thanks-modal');
        const closeBtn = document.getElementById('thanks-close');
        
        if (!modal || !closeBtn) {
          log('Error: elementos del modal no encontrados');
          return;
        }

        // Mostrar modal
        modal.style.display = 'flex';
        log('Modal de agradecimiento mostrado');

        // Función para cerrar modal
        function closeThanksModal() {
          modal.style.display = 'none';
          document.removeEventListener('keydown', handleEscapeKey);
          modal.removeEventListener('click', handleBackdropClick);
          closeBtn.removeEventListener('click', closeThanksModal);
          log('Modal de agradecimiento cerrado');
        }

        // Cerrar con tecla Escape
        function handleEscapeKey(e) {
          if (e.key === 'Escape') {
            closeThanksModal();
          }
        }

        // Cerrar haciendo clic fuera del modal
        function handleBackdropClick(e) {
          if (e.target === modal) {
            closeThanksModal();
          }
        }

        // Eventos de cierre
        closeBtn.addEventListener('click', closeThanksModal);
        document.addEventListener('keydown', handleEscapeKey);
        modal.addEventListener('click', handleBackdropClick);
      }

      // Inicialización cuando el DOM está listo
      function initializeBookingSystem() {
        const bookingBtn = document.getElementById('btn-reservar');
        const clearLogBtn = document.getElementById('clear-log');
        
        if (bookingBtn) {
          bookingBtn.addEventListener('click', openBookingPopup);
          log('Sistema de reservas inicializado correctamente');
        } else {
          log('Error: botón de reservas no encontrado');
        }

        if (clearLogBtn) {
          clearLogBtn.addEventListener('click', () => {
            document.getElementById('diagnostic-log').textContent = '';
            document.getElementById('diagnostic').style.display = 'none';
          });
        }
      }

      // Inicializar cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeBookingSystem);
      } else {
        initializeBookingSystem();
      }

      log('Script cargado - Sistema listo para reservas');

    })();

    // Animaciones suaves al cargar
    document.addEventListener('DOMContentLoaded', function() {
      const elements = document.querySelectorAll('.fade-in');
      elements.forEach((el, index) => {
        setTimeout(() => {
          el.style.opacity = '1';
          el.style.transform = 'translateY(0)';
        }, index * 200);
      });
    });
  </script>
</body>
</html>
